// Script (C) 2012 by Mark Rosenfelder.
// You can modify the code for non-commercial use; 
// attribution would be nice.
// If you want to make money off it, please contact me.

// Modified by Jason Tamez 2017-2019.
// Code available here: https://github.com/jasontamez/wordgen

// Minified by https://javascript-minifier.com/ (with extra linebreaks)


var $WG={categories:null,midWordSyls:null,wordInitSyls:null,wordFinalSyls:null,singleWordSyls:null,rew:null,previous:{categories:null,midWordSyls:null,wordInitSyls:null,wordFinalSyls:null,singleWordSyls:null,rew:null},rewSep:!1,CustomInfo:!1,Customizable:!1,getter:new XMLHttpRequest,predefFilename:"/predefs.txt",predefs:new Map,SPACE:String.fromCharCode(160),dropoff:30,monoRate:20,slowSylDrop:!1,showSyls:!1,oneType:!0};function $i(e,t=document){return t.getElementById(e)}function $q(e,t=document){return t.querySelector(e)}function $a(e,t=document){return t.querySelectorAll(e)}function $e(e,t=!1,o=!1){var r=document.createElement(e);return!1!==t&&(r.textContent=t),!1!==o&&Object.entries(o).forEach(e=>r.setAttribute(e[0],e[1])),r}function $t(e){return document.createTextNode(e)}function $f(){return document.createDocumentFragment()}function escapeHTML(e){return $e("p",e).innerHTML}function parseSyllables(e){var t=[];return e.split(/\r?\n/).forEach(function(e){var o=e.trim();""!==o&&t.push(o)}),t}function handleCategoriesInRewriteRule(e){for(var t,o,r,n=e.split("%%"),a=[],i=$WG.categories;n.length;){for(o=(t=n.shift().split("!%")).shift();t.length;){let e;r=t.shift(),e=i.get(r.charAt(0)),void 0!==test&&(o+="[^"+e+"]"),o+=r.substring(1)}for(t=o.split("%"),o=t.shift();t.length;){let e;r=t.shift(),void 0!==(e=i.get(r.charAt(0)))&&(o+="["+e+"]"),o+=r.substring(1)}a.push(o)}return a.join("%")}function applyRewriteRules(e){return $WG.rew.forEach(function(t,o){e=e.replace(o,t)}),e}function getRandomPercentage(){return Math.floor(101*Math.random())}function powerLaw(e,t){var o;for(o=0;;o=(o+1)%e)if(getRandomPercentage()<t)return o}function peakedPowerLaw(e,t,o){return Math.random()>.5?t+powerLaw(e-t,o):t-powerLaw(t+1,o)}
function oneSyllable(e,t){var o,r,n,a,i=syllPatternPick(t),l=$WG.categories,s=$WG.dropoff;for(o=0;o<i.length;o++)a=i.charAt(o),void 0===(r=l.get(a))?e+=a:(n=0===s?Math.random()*r.length:powerLaw(r.length,s),e+=r.charAt(n));return e}function syllPatternPick(e){var t,o;switch(e){case-1:o=$WG.wordInitSyls;break;case 0:o=$WG.midWordSyls;break;case 1:o=$WG.wordFinalSyls;break;case 2:o=$WG.singleWordSyls}return o[powerLaw(t=o.length,calcDropoff(t))]}function getOneWord(e){var t,o,r=1,n=$WG.monoRate,a=$WG.oneType,i="";if(101*Math.random()>=n&&(r+=1+powerLaw(4,50)),1===r)i=oneSyllable("",a?-1:2);else{let e=$WG.showSyls;for(t=1;t<=r;t++)a||1===t?o=-1:t>1&&(o=t<r?0:1),i=oneSyllable(i,o),e&&t<r&&(i+="Â·")}return i=applyRewriteRules(i),e&&(i=i.charAt(0).toUpperCase()+i.substring(1)),i}function createText(){var e,t,o,r="",n=getAdvancedNumber($i("sentences"),30,500);for(e=0;e<n;e++)for(o=peakedPowerLaw(15,5,50),t=0;t<=o;t++)r+=getOneWord(0===t),t===o&&(r+=".....?!".charAt(Math.floor(7*Math.random()))),r+=" ";return $t(r)}function createLex(e){var t,o=$e("div"),r=getAdvancedNumber($i("lexiconLength"),150,1e3),n=[];for(o.classList.add("lexicon"),o.style.gridTemplateColumns="repeat(auto-fit, minmax("+getAdvancedNumber($i("wordLengthInEms"),10,1e3).toString()+"em, 1fr) )",t=0;t<r;t++)n.push(getOneWord(e));return n.sort(),n.forEach(function(e){o.appendChild($e("div",e))}),o}function createLongLex(){var e,t=$f(),o=getAdvancedNumber($i("largeLexiconLength"),750,5e3);for(e=0;e<o;e++)t.append(getOneWord(!1),$e("br"));return t}function getAdvancedNumber(e,t,o){var r=parseInt(e.value);return isNaN(r)||r<1?t:r>o?o:r}
function getEverySyllable(){var e,t=new Set,o=$f();return new Set($WG.midWordSyls.concat($WG.wordInitSyls,$WG.wordFinalSyls,$WG.singleWordSyls)).forEach(function(e){recurseCategoriesForSyllables(t,"",e.split(""))}),(e=[...t]).sort(),o.appendChild($t(e.shift())),e.forEach(e=>o.append($e("br"),e)),o}function recurseCategoriesForSyllables(e,t,o){var r,n=o.slice(0);void 0===(r=$WG.categories.get(n.shift()))?(t+=r,n.length?recurseCategoriesForSyllables(e,t,n):e.add(applyRewriteRules(t))):n.length>0?r.split("").forEach(function(o){recurseCategoriesForSyllables(e,t+o,n)}):r.split("").forEach(function(o){e.add(applyRewriteRules(t+o))})}
function generate(){var e,t,o,r,n,a,i,l,s=[],u=$WG.categories;if(e=$q("input[type=radio][name=outType]:checked").value,$WG.showSyls=$i("showSyls").checked,$WG.slowSylDrop=$i("slowSylDrop").checked,a=$i("oneType").checked,$WG.oneType=a,i=Number($q("input[type=radio][name=monoRate]:checked").value),l=Number($q("input[type=radio][name=dropoff]:checked").value),(i=Math.min(Math.max(i,0),100))!=i&&(i=100),$WG.monoRate=i,(l=Math.min(Math.max(l,0),45))!=l&&(l=45),$WG.dropoff=l,(t=$i("categories").value)!==$WG.previous.categories){let e=parseCategories(t);e.flag&&e.cats.size>0?($WG.previous.categories=t,$WG.categories=e.cats,u=e.cats):(s.push(...e.msgs),u=!1)}if((t=$i("midWord").value)!==$WG.previous.midWordSyls&&($WG.midWordSyls=parseSyllables(t),$WG.previous.midWordSyls=t),(t=$i("wordInitial").value)!==$WG.previous.wordInitSyls&&($WG.wordInitSyls=parseSyllables(t),$WG.previous.wordInitSyls=t),(t=$i("wordFinal").value)!==$WG.previous.wordFinalSyls&&($WG.wordFinalSyls=parseSyllables(t),$WG.previous.wordFinalSyls=t),(t=$i("singleWord").value)!==$WG.previous.singleWordSyls&&($WG.singleWordSyls=parseSyllables(t),$WG.previous.singleWordSyls=t),!u||u.size<=0)(r=$f()).append($e("strong","Missing:"),$WG.SPACE+"You must have categories to generate text."),s.push(r);else if(u&&(t=$i("rewrite").value,o=$i("rewSep").value,$WG.previous.rew!==t||o!==$WG.rewSep)){let e;$WG.rewSep=o,(e=parseRewriteRules(t)).flag?($WG.previous.rew=t,$WG.rew=e.rules):s.push(...e.msgs)}if(a&&$WG.wordInitSyls.length<=0?((r=$f()).append($e("strong","Missing:"),$WG.SPACE+"You must have syllable types to generate text."),s.push(r)):!a&&($WG.midWordSyls.length<=0||$WG.wordInitSyls.length<=0||$WG.wordFinalSyls.length<=0||$WG.singleWordSyls.length<=0)&&((r=$f()).append($e("strong","Missing:"),$WG.SPACE+"You must have"+$WG.SPACE,$e("em","all"),$WG.SPACE+"syllable types to generate text."),s.push(r)),s.length>0)(n=$f()).appendChild(s.shift()),s.forEach(function(e){n.append($e("br"),$e("br"),e)});else switch(e){case"text":n=createText();break;case"dict":n=createLex(!1);break;case"dictC":n=createLex(!0);break;case"longdict":n=createLongLex();break;case"genall":n=getEverySyllable()}eraseOutputFromScreen(),$i("outputText").appendChild(n)}
function parseCategories(e){var t=e.split(/\r?\n/),o=new Map,r=[];return{flag:t.every(function(e){var t=e.trim();const n=t.length;if(0===n);else{if(n<3||1!==t.indexOf("=")||-1!==t.indexOf("=",2)){let e=$f();return e.append($e("strong","Error:"),$WG.SPACE+t,$e("br"),"Categories must be of the form V=aeiou",$e("br"),"That is, a single letter, an equal sign, then a list of possible expansions."),r.push(e),!1}{let e=t.charAt(0);if(void 0!==o.get(e)){let e=$f();return e.append($e("strong","Error:"),$WG.SPACE+"You have defined category "+t+" more than once."),r.push(e),!1}o.set(e,t.substring(2))}}return!0}),cats:o,msgs:r}}function parseRewriteRules(e){var t=e.split(/\r?\n/),o=new Map,r=[],n=$WG.rewSep;return{flag:t.every(function(e){var t=e.indexOf(n);if(""===e.trim());else{if(t<1||t!==e.lastIndexOf(n)){let t=$f();return t.append($e("strong","Error:"),$WG.SPACE+e,$e("br"),"Rewrite rules must be in the form x"+n+"y",$e("br"),"That is, a rule (x), followed by "+("||"===n?"two vertical bars":'the exact text "'+n+'"')+", followed by a replacement expression (y, which may be blank)."),r.push(t),!1}{let r=e.substring(t+2),n=new RegExp(handleCategoriesInRewriteRule(e.substring(0,t)),"g");o.set(n,r)}}return!0}),rules:o,msgs:r}}function calcDropoff(e){if(1===e)return 101;if($WG.slowSylDrop)switch(e){case 2:return 50;case 3:return 40;case 4:case 5:case 6:case 7:case 8:case 9:return 46-4*e;default:return 9}return e<9?60-5*e:12}function eraseOutputFromScreen(){for(var e=$i("outputText");e.firstChild;)e.removeChild(e.firstChild)}
function clearBoxes(){$i("categories").value="",$i("wordInitial").value="",$i("midWord").value="",$i("singleWord").value="",$i("wordFinal").value="",$i("rewrite").value="",$i("monoLessFrequent").checked=!0,$i("dropoffMedium").checked=!0,$i("textOutput").checked=!0,$i("showSyls").checked=!1,$i("slowSylDrop").checked=!1}function prepImport(e){"string"!=typeof e?$a("#importBoxArea .msg").forEach(e=>e.classList.add("hidden")):$a("#importBoxArea .msg").forEach(function(t){var o=e.split("<br>");t.textContent=o.shift(),o.forEach(function(e){t.append($e("br"),e)}),t.classList.remove("hidden")}),$i("importBoxArea").classList.remove("closed"),document.body.classList.add("noOverflow")}function removeImportBox(){$i("importTextBox").value="",$i("importBoxArea").classList.add("closed"),document.body.classList.remove("noOverflow")}function doImport(e,t=!1,o=!0){var r,n=new RegExp("--CATEGORIES--\\n([\\s\\S]*)\\n--REWRITE--\\n([\\s\\S]*)\\n--MONO--\\n([\\s\\S]*)\\n--MID--\\n([\\s\\S]*)\\n--INIT--\\n([\\s\\S]*)\\n--FINAL--\\n([\\s\\S]*)\\n--FLAGS--\\n([01]) ([01]) ([^ ]+) ([^ \\n]+)(\\n--ADVANCED--\\n([0-9]+)\\n([0-9]+)\\n([0-9]+)\\n([0-9]+)\\n([^\\n]+))?");if("string"!=typeof e&&(e=$i("importTextBox").value.trim()),r=n.exec(e),t)return null!==r||(console.log("Incorrect predef format."),!1);if(null===r)return!!o&&(console.log(r),console.log(n),console.log(e),doAlert("Incorrect format.","","error"));if($i("categories").value=r[1],$i("rewrite").value=r[2],$i("singleWord").value=r[3],$i("midWord").value=r[4],$i("wordInitial").value=r[5],$i("wordFinal").value=r[6],$i("oneType").checked="0"!==r[7],$i("slowSylDrop").checked="0"!==r[8],$i(r[9]).checked=!0,$i(r[10]).checked=!0,r.length>12&&void 0!==r[11]){let e=12;for(;e<16;){let t=Number(r[e]);(!Number.isInteger(t)||t<1)&&(r[e]="1"),e++}$i("wordLengthInEms").value=r[12],$i("lexiconLength").value=r[13],$i("largeLexiconLength").value=r[14],$i("sentences").value=r[15],$i("rewSep").value=r[16]}if(syllabicChangeDetection(),!o)return!0;doAlert("Import Successful!","","success"),removeImportBox()}
function doExport(e=!0){var t;if(null===e){let e=!0;return t="--CATEGORIES--\n"+$i("categories").defaultValue+"\n--REWRITE--\n"+$i("rewrite").defaultValue+"\n--MONO--\n"+$i("singleWord").defaultValue+"\n--MID--\n"+$i("midWord").defaultValue+"\n--INIT--\n"+$i("wordInitial").defaultValue+"\n--FINAL--\n"+$i("wordFinal").defaultValue+"\n--FLAGS--\n"+($i("oneType").defaultChecked?"1":"0")+" "+($i("slowSylDrop").defaultChecked?"1":"0")+" ",$a("input[name=monoRate]").forEach(function(o){e&&o.defaultChecked&&(t+=o.getAttribute("id")+" ",e=!1)}),e=!0,$a("input[name=dropoff]").forEach(function(o){e&&o.defaultChecked&&(t+=o.getAttribute("id"),e=!1)}),t}if(t="--CATEGORIES--\n"+$i("categories").value+"\n--REWRITE--\n"+$i("rewrite").value+"\n--MONO--\n"+$i("singleWord").value+"\n--MID--\n"+$i("midWord").value+"\n--INIT--\n"+$i("wordInitial").value+"\n--FINAL--\n"+$i("wordFinal").value+"\n--FLAGS--\n"+($i("oneType").checked?"1":"0")+" "+($i("slowSylDrop").checked?"1":"0")+" "+$q("input[name=monoRate]:checked").getAttribute("id")+" "+$q("input[name=dropoff]:checked").getAttribute("id"),!e)return t;t+="\n--ADVANCED--\n"+$i("wordLengthInEms").value+"\n"+$i("lexiconLength").value+"\n"+$i("largeLexiconLength").value+"\n"+$i("sentences").value+"\n"+$i("rewSep").value,$i("importTextBox").value=t,prepImport("Copy this for your own records.<br><br>Hit 'Cancel' when you're done.")}
function saveCustom(e){var t=$i("predef");if($WG.Customizable){if($WG.CustomInfo&&!0!==e)return doConfirm("Warning!","You already have information saved. Do you want to overwrite it?",function(){saveCustom(!0)},function(){doAlert("Previous information saved.","Nothing overwritten.","success")},"warning","Yes","No");if(localStorage.setItem("CustomCategories",$i("categories").value),localStorage.setItem("CustomRewrite",$i("rewrite").value),localStorage.setItem("CustomSingleWord",$i("singleWord").value),localStorage.setItem("CustomMidWord",$i("midWord").value),localStorage.setItem("CustomInitial",$i("wordInitial").value),localStorage.setItem("CustomFinal",$i("wordFinal").value),localStorage.setItem("CustomOneType",$i("oneType").checked),localStorage.setItem("CustomSlowSylDrop",$i("slowSylDrop").checked),localStorage.setItem("CustomMono",$q("input[name=monoRate]:checked").getAttribute("id")),localStorage.setItem("CustomDropoff",$q("input[name=dropoff]:checked").getAttribute("id")),localStorage.setItem("CustomWordLengthInEms",$i("wordLengthInEms").value),localStorage.setItem("CustomLexiconLength",$i("lexiconLength").value),localStorage.setItem("CustomLargeLexiconLength",$i("largeLexiconLength").value),localStorage.setItem("CustomSentences",$i("sentences").value),localStorage.setItem("CustomRewSep",$i("rewSep").value),$WG.CustomInfo=!0,null==$q('option[value="pd-1"]',t)){let e=document.createElement("option");e.value="pd-1",e.textContent="Custom",t.prepend(e)}t.value="pd-1",$WG.predefs.set("pd-1",doExport(!1)),doAlert("Saved to browser.","","success")}else doAlert("","Your browser does not support Local Storage and cannot save your information.","error")}
function clearCustom(e){if($WG.Customizable)if($WG.CustomInfo){if($WG.CustomInfo&&!0!==e)return doConfirm("Warning!","Are you sure you want to delete your saved settings?",function(){clearCustom(!0)},function(){doAlert("Settings kept.","","success")},"warning","Yes","No");["CustomCategories","CustomRewrite","CustomSingleWord","CustomMidWord","CustomInitial","CustomFinal","CustomOneType","CustomSlowSylDrop","CustomMono","CustomDropoff","CustomWordLengthInEms","CustomLexiconLength","CustomLargeLexiconLength","CustomSentences","CustomRewSep"].forEach(function(e){window.localStorage.removeItem(e)}),$WG.CustomInfo=!1,$q('#predef option[value="-1"]').remove(),$WG.predefs.delete("pd-1"),doAlert("Cleared from browser.","","success")}else doAlert("","You don't have anything saved.","error");else doAlert("Sorry!","Your browser does not support Local Storage and cannot save your information.","error")}function showIPA(){eraseOutputFromScreen(),$i("outputText").appendChild(createIPASymbolsFragment([$e("br"),$e("br")]))}function advancedOptions(){$i("advancedOpen").classList.toggle("closed")}function loadPredef(){var e=$i("predef").value;console.log("Opening predef ["+e+"]"),doImport($WG.predefs.get(e),!1,!1),syllabicChangeDetection()}function parseResult(){var e=$WG.getter.responseText.trim().split(/\n--END--/),t=$WG.predefs.size+(void 0===$WG.predefs.get("pd-1")?0:-1);e.forEach(function(e){var o=e.trim().match(/^([^\r\n]+)\r?\n/);if(null===o)console.log("Unable to parse predef name: "+e);else{let r=o[0].trim(),n=e.slice(o[0].length).replace(/\r/g,"").trim();if(console.log("Testing predef: "+r),doImport(n,!0)){let e=$i("predef"),o=document.createElement("option"),a="pd";console.log("Saving predef: "+r),a+=(++t).toString(),$WG.predefs.set(a,n),o.textContent=r,o.value=a,e.appendChild(o)}else console.log(n.replace(/\n/g,"\\n"))}}),$i("loadPredefButton").disabled=!1,$i("predef").disabled=!1}
function syllabicChangeDetection(){$i("oneType").checked?($a("#p_multi,.multiswap").forEach(e=>e.classList.add("hidden")),$a(".singleswap").forEach(e=>e.classList.remove("hidden"))):($a("#p_multi,.multiswap").forEach(e=>e.classList.remove("hidden")),$a(".singleswap").forEach(e=>e.classList.add("hidden")))}if($WG.getter.addEventListener("load",parseResult),$WG.getter.open("GET",$WG.predefFilename),$WG.getter.send(),$i("loadPredefButton").disabled=!0,$i("predef").disabled=!0,$WG.predefs.set("pd1",doExport(null)),"undefined"!=typeof Storage){if($WG.Customizable=!0,null!==localStorage.getItem("CustomCategories")){$WG.CustomInfo=!0;let e=document.createElement("option"),t=[localStorage.getItem("CustomMono"),localStorage.getItem("CustomDropoff")],o=[];$i("categories").value=localStorage.getItem("CustomCategories"),$i("rewrite").value=localStorage.getItem("CustomRewrite"),$i("singleWord").value=localStorage.getItem("CustomSingleWord"),$i("midWord").value=localStorage.getItem("CustomMidWord"),$i("wordInitial").value=localStorage.getItem("CustomInitial"),$i("wordFinal").value=localStorage.getItem("CustomFinal"),"true"===localStorage.getItem("CustomOneType")?t.push("oneType"):o.push("oneType"),"true"===localStorage.getItem("CustomSlowSylDrop")?t.push("slowSylDrop"):o.push("slowSylDrop"),t.forEach(e=>$i(e).checked=!0),o.forEach(e=>$i(e).checked=!1),$WG.predefs.set("pd-1",doExport(!1)),e.value="pd-1",e.textContent="Custom",$i("predef").prepend(e),$i("predef").value="pd-1"}syllabicChangeDetection()}
function doAlert(e,t,o){"undefined"!=typeof Swal?Swal.fire({type:o,title:e,html:t,customClass:"doAlertBox",buttonsStyling:!1}):alert((e+" "+t.replace(/<br>/g,"\n").replace(/<[^>]*>/g,"")).trim())}function doConfirm(e,t,o,r,n="question",a="Ok",i="Cancel"){"undefined"!=typeof Swal?Swal.fire({title:e,html:t,type:n,showCancelButton:!0,confirmButtonText:a,cancelButtonText:i,customClass:"doAlertBox",buttonsStyling:!1}).then(e=>e.value?o.call():r.call()):confirm((e+" "+t.replace(/<br>/g,"\n").replace(/<[^>]*>/g,"")).trim())?o.call():r.call()}$i("oneType").addEventListener("change",syllabicChangeDetection),syllabicChangeDetection(),$i("advancedOpenButton").addEventListener("click",advancedOptions),$i("saveCustomButton").addEventListener("click",saveCustom),$i("clearCustomButton").addEventListener("click",clearCustom),$i("prepImportButton").addEventListener("click",prepImport),$i("generateButton").addEventListener("click",generate),$i("eraseButton").addEventListener("click",eraseOutputFromScreen),$i("clearBoxesButton").addEventListener("click",clearBoxes),$i("showIPAButton").addEventListener("click",showIPA),$i("loadPredefButton").addEventListener("click",loadPredef),$i("doImportButton").addEventListener("click",doImport),$i("removeImportBoxButton").addEventListener("click",removeImportBox),$i("doExportButton").addEventListener("click",doExport);
