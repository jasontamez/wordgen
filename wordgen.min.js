// Script (C) 2012 by Mark Rosenfelder.
// You can modify the code for non-commercial use; 
// attribution would be nice.
// If you want to make money off it, please contact me.

// Modified by Jason Tamez 2017-2019.
// Code available here: https://github.com/jasontamez/wordgen


// ==ClosureCompiler==
// @compilation_level SIMPLE_OPTIMIZATIONS
// ==/ClosureCompiler==

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};var categories,previousCat=!1,midWordSyls,wordInitSyls,wordFinalSyls,singleWordSyls,previousMidWordSyls=!1,previousWordInitSyls=!1,previousWordFinalSyls=!1,previousSingleWordSyls=!1,rew,nrew,previousRew=!1,rewSep=!1,CustomInfo=!1,Customizable=!1,getter=new XMLHttpRequest,predefFilename="/predefs.txt",predefs={};function $i(a,b){b=void 0===b?document:b;return b.getElementById(a)}
function $q(a,b){b=void 0===b?document:b;return b.querySelector(a)}function $a(a,b){b=void 0===b?document:b;return b.querySelectorAll(a)}function $e(a,b,c){b=void 0===b?!1:b;c=void 0===c?!1:c;var d=document.createElement(a);!1!==b&&(d.textContent=b);!1!==c&&Object.entries(c).forEach(function(a){return d.setAttribute(a[0],a[1])});return d}function $t(a){return document.createTextNode(a)}function $f(){return document.createDocumentFragment()}
function parseSyllables(a){var b=[];a.split(/\r?\n/).forEach(function(a){a=a.trim();""!==a&&b.push(a)});return b}
function handleCategoriesInRewriteRule(a){a=a.split("%%");for(var b=[],c,d,f,h;a.length;){c=a.shift().split("!%");for(f=c.shift();c.length;)h=c.shift(),d=h.charAt(0),-1!==categories.index.indexOf(d)&&(f+="[^"+categories[d]+"]"),f+=h.substring(1);c=f.split("%");for(f=c.shift();c.length;)h=c.shift(),d=h.charAt(0),-1!==categories.index.indexOf(d)&&(f+="["+categories[d]+"]"),f+=h.substring(1);b.push(f)}return b.join("%")}
function applyRewriteRules(a){var b;for(b=0;b<nrew;b++){var c=rew[b.toString()];a=a.replace(c[0],c[1])}return a}function getRandomPercentage(){return Math.floor(101*Math.random())}function powerLaw(a,b){var c;for(c=0;;c=(c+1)%a)if(getRandomPercentage()<b)return c}function peakedPowerLaw(a,b,c){return.5<Math.random()?b+powerLaw(a-b,c):b-powerLaw(b+1,c)}
function oneSyllable(a,b,c,d){b=syllPatternPick(b,d);for(d=0;d<b.length;d++){var f=b.charAt(d);if(-1===categories.index.indexOf(f))a+=f;else{f=categories[f];var h=0===c?Math.random()*f.length:powerLaw(f.length,c);f=f.charAt(h);a+=f}}return a}
function syllPatternPick(a,b){switch(a){case -1:var c=wordInitSyls.length;var d=wordInitSyls;break;case 0:c=midWordSyls.length;d=midWordSyls;break;case 1:c=wordFinalSyls.length;d=wordFinalSyls;break;case 2:c=singleWordSyls.length,d=singleWordSyls}return d[powerLaw(c,calcDropoff(c,b))]}
function getOneWord(a,b,c,d,f,h){var g=1,e,k="";Math.random()>b&&(g+=1+powerLaw(4,50));if(1===g)k=oneSyllable("",c?-1:2,f,h);else for(b=1;b<=g;b++)c||1===b?e=-1:1<b&&(e=b<g?0:1),k=oneSyllable(k,e,f,h),d&&b<g&&(k+="\u00b7");k=applyRewriteRules(k);a&&(k=k.charAt(0).toUpperCase()+k.substring(1));return k}
function createText(a,b,c,d,f){var h,g,e="",k=getAdvancedNumber($i("sentences"),30,500);for(h=0;h<k;h++){var l=1+peakedPowerLaw(15,5,50);for(g=0;g<l;g++)e+=getOneWord(0===g,a,b,c,d,f),g===l-1&&(e+=".....?!".charAt(Math.floor(7*Math.random()))),e+=" "}return $t(e)}
function createLex(a,b,c,d,f,h){var g,e=$e("div"),k=getAdvancedNumber($i("lexiconLength"),150,1E3);e.classList.add("lexicon");e.style.gridTemplateColumns="repeat(auto-fit, minmax("+getAdvancedNumber($i("wordLengthInEms"),10,1E3).toString()+"em, 1fr) )";for(g=0;g<k;g++){var l=$e("div",getOneWord(a,b,c,d,f,h));e.appendChild(l)}return e}
function createLongLex(a,b,c,d,f){var h,g=$f(),e=getAdvancedNumber($i("largeLexiconLength"),750,5E3);for(h=0;h<e;h++)g.append(getOneWord(!1,a,b,c,d,f),$e("br"));return g}function getAdvancedNumber(a,b,c){a=parseInt(a.value);return isNaN(a)||1>a?b:a>c?c:a}
function getEverySyllable(){var a=new Set,b=$f();(new Set(midWordSyls.concat(wordInitSyls,wordFinalSyls,singleWordSyls))).forEach(function(b){recurseCategories(a,"",b.split(""))});var c=[].concat($jscomp.arrayFromIterable(a));c.sort();b.appendChild($t(c.shift()));c.forEach(function(a){return b.append($e("br"),a)});return b}
function recurseCategories(a,b,c){var d=[];d.push.apply(d,$jscomp.arrayFromIterable(c));c=d.shift();-1===categories.index.indexOf(c)?(b+=c,d.length?recurseCategories(a,b,d):a.add(applyRewriteRules(b))):0<d.length?categories[c].split("").forEach(function(c){recurseCategories(a,b+c,d)}):categories[c].split("").forEach(function(c){a.add(applyRewriteRules(b+c))})}function escapeHTML(a){return $e("p",a).innerHTML}
function generate(){var a=[];var b=$q("input[type=radio][name=outType]:checked").value;var c=$i("showSyls").checked;var d=$i("slowSylDrop").checked;var f=$i("oneType").checked;var h=Number($q("input[type=radio][name=monoRate]:checked").value);var g=Number($q("input[type=radio][name=dropoff]:checked").value);h=Math.min(Math.max(h,0),1);h!==h&&(h=1);g=Math.min(Math.max(g,0),45);g!==g&&(g=45);var e=$i("categories").value;if(e!==previousCat){var k=parseCategories(e);k.flag&&0<k.cats.length?(previousCat=
e,categories=k.cats):a.push.apply(a,$jscomp.arrayFromIterable(k.msgs))}e=$i("midWord").value;e!==previousMidWordSyls&&(midWordSyls=parseSyllables(e),previousMidWordSyls=e);e=$i("wordInitial").value;e!==previousWordInitSyls&&(wordInitSyls=parseSyllables(e),previousWordInitSyls=e);e=$i("wordFinal").value;e!==previousWordFinalSyls&&(wordFinalSyls=parseSyllables(e),previousWordFinalSyls=e);e=$i("singleWord").value;e!==previousSingleWordSyls&&(singleWordSyls=parseSyllables(e),previousSingleWordSyls=e);
e=$i("rewrite").value;k=$i("rewSep").value;if(previousRew!==e||k!==rewSep)rewSep=k,k=parseRewriteRules(e),k.flag?(previousRew=e,nrew=k.len,rew=k.rules):a.push.apply(a,$jscomp.arrayFromIterable(k.msgs));0>=categories.length&&(e=$f(),e.append($e("strong","Missing:"),String.fromCharCode(160)+"You must have categories to generate text."),a.push(e));f&&0>=wordInitSyls.length?(e=$f(),e.append($e("strong","Missing:"),String.fromCharCode(160)+"You must have syllable types to generate text."),a.push(e)):!f&&
(0>=midWordSyls.length||0>=wordInitSyls.length||0>=wordFinalSyls.length||0>=singleWordSyls.length)&&(e=$f(),e.append($e("strong","Missing:"),String.fromCharCode(160)+"You must have"+String.fromCharCode(160),$e("em","all"),String.fromCharCode(160)+"syllable types to generate text."),a.push(e));if(0<a.length){var l=$f();l.appendChild(a.shift());a.forEach(function(a){l.append($e("br"),$e("br"),a)})}else switch(b){case "text":l=createText(h,f,c,g,d);break;case "dict":l=createLex(!1,h,f,c,g,d);break;case "dictC":l=
createLex(!0,h,f,c,g,d);break;case "longdict":l=createLongLex(h,f,c,g,d);break;case "genall":l=getEverySyllable()}erase();$i("outputText").appendChild(l)}
function parseCategories(a){a=a.split(/\r?\n/);var b={length:a.length,index:""},c=[];return{flag:a.every(function(a){a=a.trim();var d=a.length;if(0===d)b.length--;else{if(3>d||1!==a.indexOf("=")||-1!==a.indexOf("=",2))return d=$f(),d.append($e("strong","Error:"),String.fromCharCode(160)+a,$e("br"),"Categories must be of the form V=aeiou",$e("br"),"That is, a single letter, an equal sign, then a list of possible expansions."),c.push(d),!1;d=a.charAt(0);if(b.hasOwnProperty(d))return d=$f(),d.append($e("strong",
"Error:"),String.fromCharCode(160)+"You have defined category "+a+" more than once."),c.push(d),!1;b.index+=d;b[d]=a.substring(2)}return!0}),cats:b,msgs:c}}
function parseRewriteRules(a){a=a.split(/\r?\n/);var b=a.length,c=0,d={},f=[];return{flag:a.every(function(a){var g=a.indexOf(rewSep);if(""===a.trim())b--;else{if(1>g||g!==a.lastIndexOf(rewSep)){var e=$f();e.append($e("strong","Error:"),String.fromCharCode(160)+a,$e("br"),"Rewrite rules must be in the form x"+rewSep+"y",$e("br"),"That is, a rule (x), followed by "+("||"===rewSep?"two vertical bars":'the exact text "'+rewSep+'"')+", followed by a replacement expression (y, which may be blank).");f.push(e);
return!1}e=a.substring(g+2);a=new RegExp(handleCategoriesInRewriteRule(a.substring(0,g)),"g");d[c.toString()]=[a,e];c++}return!0}),rules:d,len:b,msgs:f}}function calcDropoff(a,b){if(1===a)return 101;if(b)switch(a){case 2:return 50;case 3:return 40;case 4:case 5:case 6:case 7:case 8:case 9:return 46-4*a;default:return 9}return 9>a?60-5*a:12}function erase(){for(var a=$i("outputText");a.firstChild;)a.removeChild(a.firstChild)}
function clearBoxes(){$i("categories").value="";$i("wordInitial").value="";$i("midWord").value="";$i("singleWord").value="";$i("wordFinal").value="";$i("rewrite").value="";$i("monoLessFrequent").checked=!0;$i("dropoffMedium").checked=!0;$i("textOutput").checked=!0;$i("showSyls").checked=!1;$i("slowSylDrop").checked=!1;$i("defaultName").textContent=""}
function prepImport(a){"string"!==typeof a?$a("#importBoxArea .msg").forEach(function(a){return a.classList.add("hidden")}):$a("#importBoxArea .msg").forEach(function(b){b.classList.remove("hidden");b.textContent=a});$i("importBoxArea").classList.remove("closed");document.body.classList.add("noOverflow")}function removeImportBox(){$i("importTextBox").value="";$i("importBoxArea").classList.add("closed");document.body.classList.remove("noOverflow")}
function doImport(a,b,c){a=void 0===a?$i("importTextBox").value.trim():a;b=void 0===b?!1:b;c=void 0===c?!0:c;a=/--CATEGORIES--\n([\s\S]*)\n--REWRITE--\n([\s\S]*)\n--MONO--\n([\s\S]*)\n--MID--\n([\s\S]*)\n--INIT--\n([\s\S]*)\n--FINAL--\n([\s\S]*)\n--FLAGS--\n([01]) ([01]) ([^ ]+) ([^ \n]+)(\n--ADVANCED--\n([0-9]+)\n([0-9]+)\n([0-9]+)\n([0-9]+)\n([^\n]+))?/.exec(a);if(b)return null===a?(console.log("Incorrect predef format."),!1):!0;if(null===a)return c?doAlert("Incorrect format.","","error"):!1;$i("categories").value=
a[1];$i("rewrite").value=a[2];$i("singleWord").value=a[3];$i("midWord").value=a[4];$i("wordInitial").value=a[5];$i("wordFinal").value=a[6];$i("oneType").checked="0"!==a[7];$i("slowSylDrop").checked="0"!==a[8];$i(a[9]).checked=!0;$i(a[10]).checked=!0;if(12<a.length&&void 0!==a[11]){for(b=12;16>b;){var d=Number(a[b]);if(!Number.isInteger(d)||1>d)a[b]="1";b++}$i("wordLengthInEms").value=a[12];$i("lexiconLength").value=a[13];$i("largeLexiconLength").value=a[14];$i("sentences").value=a[15];$i("rewSep").value=
a[16]}syllablicChangeDetection();if(!c)return!0;doAlert("Import Successful!","","success");removeImportBox()}
function doExport(a){a=void 0===a?!0:a;if(null===a){var b=!0;var c="--CATEGORIES--\n"+$i("categories").defaultValue+"\n--REWRITE--\n"+$i("rewrite").defaultValue+"\n--MONO--\n"+$i("singleWord").defaultValue+"\n--MID--\n"+$i("midWord").defaultValue+"\n--INIT--\n"+$i("wordInitial").defaultValue+"\n--FINAL--\n"+$i("wordFinal").defaultValue+"\n--FLAGS--\n"+($i("oneType").defaultChecked?"1":"0")+" "+($i("slowSylDrop").defaultChecked?"1":"0")+" ";$a("input[name=monoRate]").forEach(function(a){b&&a.defaultChecked&&
(c+=a.getAttribute("id")+" ",b=!1)});b=!0;$a("input[name=dropoff]").forEach(function(a){b&&a.defaultChecked&&(c+=a.getAttribute("id"),b=!1)});return c}c="--CATEGORIES--\n"+$i("categories").value+"\n--REWRITE--\n"+$i("rewrite").value+"\n--MONO--\n"+$i("singleWord").value+"\n--MID--\n"+$i("midWord").value+"\n--INIT--\n"+$i("wordInitial").value+"\n--FINAL--\n"+$i("wordFinal").value+"\n--FLAGS--\n"+($i("oneType").checked?"1":"0")+" "+($i("slowSylDrop").checked?"1":"0")+" "+$q("input[name=monoRate]:checked").getAttribute("id")+
" "+$q("input[name=dropoff]:checked").getAttribute("id");if(!a)return c;c+="\n--ADVANCED--\n"+$i("wordLengthInEms").value+"\n"+$i("lexiconLength").value+"\n"+$i("largeLexiconLength").value+"\n"+$i("sentences").value+"\n"+$i("rewSep").value;$i("importTextBox").value=c;prepImport("Copy this for your own records.<br><br>Hit 'Cancel' when you're done.")}
function saveCustom(a){var b=$i("predef");if(Customizable){if(CustomInfo&&!0!==a)return doConfirm("Warning!","You already have information saved. Do you want to overwrite it?",function(){saveCustom(!0)},function(){doAlert("Previous information saved.","Nothing overwritten.","success")},"warning","Yes","No");localStorage.setItem("CustomCategories",$i("categories").value);localStorage.setItem("CustomRewrite",$i("rewrite").value);localStorage.setItem("CustomSingleWord",$i("singleWord").value);localStorage.setItem("CustomMidWord",
$i("midWord").value);localStorage.setItem("CustomInitial",$i("wordInitial").value);localStorage.setItem("CustomFinal",$i("wordFinal").value);localStorage.setItem("CustomOneType",$i("oneType").checked);localStorage.setItem("CustomSlowSylDrop",$i("slowSylDrop").checked);localStorage.setItem("CustomMono",$q("input[name=monoRate]:checked").getAttribute("id"));localStorage.setItem("CustomDropoff",$q("input[name=dropoff]:checked").getAttribute("id"));localStorage.setItem("CustomWordLengthInEms",$i("wordLengthInEms").value);
localStorage.setItem("CustomLexiconLength",$i("lexiconLength").value);localStorage.setItem("CustomLargeLexiconLength",$i("largeLexiconLength").value);localStorage.setItem("CustomSentences",$i("sentences").value);localStorage.setItem("CustomRewSep",$i("rewSep").value);CustomInfo=!0;null==$q('option[value="pd-1"]',b)&&(a=document.createElement("option"),a.value="pd-1",a.textContent="Custom",b.prepend(a));b.value="pd-1";predefs["pd-1"]=doExport(!1);doAlert("Saved to browser.","","success")}else doAlert("",
"Your browser does not support Local Storage and cannot save your information.","error")}
function clearCustom(a){if(Customizable)if(CustomInfo){if(CustomInfo&&!0!==a)return doConfirm("Warning!","Are you sure you want to delete your saved settings?",function(){clearCustom(!0)},function(){doAlert("Settings kept.","","success")},"warning","Yes","No");"CustomCategories CustomRewrite CustomSingleWord CustomMidWord CustomInitial CustomFinal CustomOneType CustomSlowSylDrop CustomMono CustomDropoff CustomWordLengthInEms CustomLexiconLength CustomLargeLexiconLength CustomSentences CustomRewSep".split(" ").forEach(function(a){window.localStorage.removeItem(a)});CustomInfo=
!1;$q('#predef option[value="-1"]').remove();delete predefs["pd-1"];doAlert("Cleared from browser.","","success")}else doAlert("","You don't have anything saved.","error");else doAlert("Sorry!","Your browser does not support Local Storage and cannot save your information.","error")}function showIPA(){erase();$i("outputText").appendChild(createIPASymbolsFragment([$e("br"),$e("br")]))}function advancedOptions(){$i("advancedOpen").classList.toggle("closed")}
function loadThisPredef(a){console.log("DEPRECATED FUNCTION CALL")}function loadPredef(){var a=$i("predef").value;console.log(a);doImport(predefs[a],!1,!1);syllablicChangeDetection()}getter.addEventListener("load",parseResult);getter.open("GET",predefFilename);getter.send();$i("loadPredefButton").disabled=!0;$i("predef").disabled=!0;predefs.pd1=doExport(null);predefs.counter=1;
function parseResult(){getter.responseText.trim().split(/\n--END--/).forEach(function(a){var b=a.trim().match(/^([^\r\n]+)\r?\n/);if(null===b)console.log("Unable to parse predef name: "+a);else{var c=b[0].trim();a=a.slice(b[0].length).replace(/\r/g,"").trim();console.log("Testing predef: "+c);if(doImport(a,!0)){b=$i("predef");var d=document.createElement("option"),f="pd";console.log("Saving predef: "+c);predefs.counter++;f+=predefs.counter.toString();predefs[f]=a;d.textContent=c;d.value=f;b.appendChild(d)}else console.log(a.replace(/\n/g,
"\\n"))}});$i("loadPredefButton").disabled=!1;$i("predef").disabled=!1}function syllablicChangeDetection(){$i("oneType").checked?($a("#p_multi,.multiswap").forEach(function(a){return a.classList.add("hidden")}),$a(".singleswap").forEach(function(a){return a.classList.remove("hidden")})):($a("#p_multi,.multiswap").forEach(function(a){return a.classList.remove("hidden")}),$a(".singleswap").forEach(function(a){return a.classList.add("hidden")}))}
if("undefined"!==typeof Storage){Customizable=!0;if(null!==localStorage.getItem("CustomCategories")){CustomInfo=!0;var option=document.createElement("option"),propTrue=[localStorage.getItem("CustomMono"),localStorage.getItem("CustomDropoff")],propFalse=[];$i("categories").value=localStorage.getItem("CustomCategories");$i("rewrite").value=localStorage.getItem("CustomRewrite");$i("singleWord").value=localStorage.getItem("CustomSingleWord");$i("midWord").value=localStorage.getItem("CustomMidWord");$i("wordInitial").value=
localStorage.getItem("CustomInitial");$i("wordFinal").value=localStorage.getItem("CustomFinal");"true"===localStorage.getItem("CustomOneType")?propTrue.push("oneType"):propFalse.push("oneType");"true"===localStorage.getItem("CustomSlowSylDrop")?propTrue.push("slowSylDrop"):propFalse.push("slowSylDrop");propTrue.forEach(function(a){return $i(a).checked=!0});propFalse.forEach(function(a){return $i(a).checked=!1});predefs["pd-1"]=doExport(!1);option.value="pd-1";option.textContent="Custom";$i("predef").prepend(option);
$i("predef").value="pd-1"}syllablicChangeDetection()}$i("oneType").addEventListener("change",function(a){syllablicChangeDetection()});syllablicChangeDetection();$i("advancedOpenButton").addEventListener("click",advancedOptions);$i("saveCustomButton").addEventListener("click",saveCustom);$i("clearCustomButton").addEventListener("click",clearCustom);$i("prepImportButton").addEventListener("click",prepImport);$i("generateButton").addEventListener("click",generate);
$i("eraseButton").addEventListener("click",erase);$i("clearBoxesButton").addEventListener("click",clearBoxes);$i("showIPAButton").addEventListener("click",showIPA);$i("loadPredefButton").addEventListener("click",loadPredef);$i("doImportButton").addEventListener("click",doImport);$i("removeImportBoxButton").addEventListener("click",removeImportBox);$i("doExportButton").addEventListener("click",doExport);
function doAlert(a,b,c){"undefined"!==typeof Swal?Swal.fire({type:c,title:a,html:b,customClass:"doAlertBox",buttonsStyling:!1}):alert((a+" "+b.replace(/<br>/g,"\n").replace(/<[^>]*>/g,"")).trim())}
function doConfirm(a,b,c,d,f,h,g){"undefined"!==typeof Swal?Swal.fire({title:a,html:b,type:void 0===f?"question":f,showCancelButton:!0,confirmButtonText:void 0===h?"Ok":h,cancelButtonText:void 0===g?"Cancel":g,customClass:"doAlertBox",buttonsStyling:!1}).then(function(a){return a.value?c():d()}):confirm((a+" "+b.replace(/<br>/g,"\n").replace(/<[^>]*>/g,"")).trim())?c():d()};
