// Script (C) 2012 by Mark Rosenfelder.
// You can modify the code for non-commercial use; 
// attribution would be nice.
// If you want to make money off it, please contact me.

// Modified by Jason Tamez 2017-2019.
// Code available here: https://github.com/jasontamez/wordgen


// ==ClosureCompiler==
// @compilation_level SIMPLE_OPTIMIZATIONS
// ==/ClosureCompiler==

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};var categories,previousCat=!1,midWordSyls,wordInitSyls,wordFinalSyls,singleWordSyls,previousMidWordSyls=!1,previousWordInitSyls=!1,previousWordFinalSyls=!1,previousSingleWordSyls=!1,rew,nrew,previousRew=!1,rewSep=!1,CustomInfo=!1,Customizable=!1,getter=new XMLHttpRequest,predefFilename="/predefs.txt",predefs={};
function parseSyllables(a){var b=[];a.split(/\r?\n/).forEach(function(a){a=a.trim();""!==a&&b.push(a)});return b}
function handleCategoriesInRewriteRule(a){a=a.split("%%");for(var b=[],c,d,e,h;a.length;){c=a.shift().split("!%");for(e=c.shift();c.length;)h=c.shift(),d=h.charAt(0),-1!==categories.index.indexOf(d)&&(e+="[^"+categories[d]+"]"),e+=h.substring(1);c=e.split("%");for(e=c.shift();c.length;)h=c.shift(),d=h.charAt(0),-1!==categories.index.indexOf(d)&&(e+="["+categories[d]+"]"),e+=h.substring(1);b.push(e)}return b.join("%")}
function applyRewriteRules(a){var b;for(b=0;b<nrew;b++){var c=rew[b.toString()];a=a.replace(c[0],c[1])}return a}function getRandomPercentage(){return Math.floor(101*Math.random())}function powerLaw(a,b){var c;for(c=0;;c=(c+1)%a)if(getRandomPercentage()<b)return c}function peakedPowerLaw(a,b,c){return.5<Math.random()?b+powerLaw(a-b,c):b-powerLaw(b+1,c)}
function oneSyllable(a,b,c,d){b=syllPatternPick(b,d);for(d=0;d<b.length;d++){var e=b.charAt(d);if(-1===categories.index.indexOf(e))a+=e;else{e=categories[e];var h=0===c?Math.random()*e.length:powerLaw(e.length,c);e=e.charAt(h);a+=e}}return a}
function syllPatternPick(a,b){switch(a){case -1:var c=wordInitSyls.length;var d=wordInitSyls;break;case 0:c=midWordSyls.length;d=midWordSyls;break;case 1:c=wordFinalSyls.length;d=wordFinalSyls;break;case 2:c=singleWordSyls.length,d=singleWordSyls}return d[powerLaw(c,calcDropoff(c,b))]}
function getOneWord(a,b,c,d,e,h){var g=1,k,f="";Math.random()>b&&(g+=1+powerLaw(4,50));if(1===g)f=oneSyllable("",c?-1:2,e,h);else for(b=1;b<=g;b++)c||1===b?k=-1:1<b&&(k=b<g?0:1),f=oneSyllable(f,k,e,h),d&&b<g&&(f+="\u00b7");f=applyRewriteRules(f);a&&(f=f.charAt(0).toUpperCase()+f.substring(1));return f}
function createText(a,b,c,d,e){var h,g,k="",f=getAdvancedNumber("#sentences",30,500);for(h=0;h<f;h++){var l=1+peakedPowerLaw(15,5,50);for(g=0;g<l;g++)k+=getOneWord(0===g,a,b,c,d,e),g===l-1&&(k+=".....?!".charAt(Math.floor(7*Math.random()))),k+=" "}return k}
function createLex(a,b,c,d,e,h){var g,k='<div class="lexicon" style="grid-template-columns: repeat(auto-fit, minmax('+getAdvancedNumber("#wordLengthInEms",10,1E3)+'em, 1fr) )">\n',f=getAdvancedNumber("#lexiconLength",150,1E3);for(g=0;g<f;g++)k+="<div>"+getOneWord(a,b,c,d,e,h)+"</div>";return k+"</table></div>\n"}function createLongLex(a,b,c,d,e){var h,g="",k=getAdvancedNumber("largeLexiconLength",750,5E3);for(h=0;h<5*k;h++)g+=getOneWord(!1,a,b,c,d,e)+"<br>\n";return g}
function getAdvancedNumber(a,b,c){a=parseInt(a.value);return isNaN(a)||1>a?b:a>c?c:a}function getEverySyllable(){var a=new Set;(new Set(midWordSyls.concat(wordInitSyls,wordFinalSyls,singleWordSyls))).forEach(function(b){recurseCategories(a,"",b.split(""))});var b=[].concat($jscomp.arrayFromIterable(a));b.sort();return b.join("<br>")}
function recurseCategories(a,b,c){var d=[];d.push.apply(d,$jscomp.arrayFromIterable(c));c=d.shift();-1===categories.index.indexOf(c)?(b+=c,d.length?recurseCategories(a,b,d):a.add(applyRewriteRules(b))):0<d.length?categories[c].split("").forEach(function(c){recurseCategories(a,b+c,d)}):categories[c].split("").forEach(function(c){a.add(applyRewriteRules(b+c))})}function escapeHTML(a){a=document.createTextNode(a);var b=document.createElement("p");b.appendChild(a);return b.innerHTML}
function generate(){var a,b=[];var c=document.querySelector("input[type=radio][name=outType]:checked").value;var d=document.getElementById("showSyls").checked;var e=document.getElementById("slowSylDrop").checked;var h=document.getElementById("oneType").checked;var g=Number(document.querySelector("input[type=radio][name=monoRate]:checked").value);var k=Number(document.querySelector("input[type=radio][name=dropoff]:checked").value);g!==g||1<g?g=1:0>g&&(g=0);k!==k||45<k?k=45:0>k&&(k=0);var f=document.getElementById("categories").value;
if(f!==previousCat){var l=f.split(/\r?\n/);var n=l.length;categories={index:""};(l=l.every(function(c){c=c.trim();var d=c.length;if(0===d)n--;else{if(3>d||1!==c.indexOf("=")||-1!==c.indexOf("=",2))return b.push("<strong>Error:</strong>"+escapeHTML(c)+"<br>Categories must be of the form V=aeiou<br>That is, a single letter, an equal sign, then a list of possible expansions."),!1;a=c.charAt(0);if(categories.hasOwnProperty(a))return b.push("<strong>Error:</strong> You have defined category "+escapeHTML(a)+
" more than once."),!1;categories.index+=c.charAt(0);categories[a]=c.substring(2)}return!0}))&&0<n&&(previousCat=f,categories.length=n)}f=document.getElementById("midWord").value;f!==previousMidWordSyls&&(midWordSyls=parseSyllables(f),previousMidWordSyls=f);f=document.getElementById("wordInitial").value;f!==previousWordInitSyls&&(wordInitSyls=parseSyllables(f),previousWordInitSyls=f);f=document.getElementById("wordFinal").value;f!==previousWordFinalSyls&&(wordFinalSyls=parseSyllables(f),previousWordFinalSyls=
f);f=document.getElementById("singleWord").value;f!==previousSingleWordSyls&&(singleWordSyls=parseSyllables(f),previousSingleWordSyls=f);f=document.getElementById("rewrite").value;l=document.getElementById("rewSep").value;if(previousRew!==f||l!==rewSep){rewSep=l;l=f.split(/\r?\n/);nrew=l.length;rew={};var p=0;(l=l.every(function(a){var c=a.indexOf(rewSep);if(""===a.trim())nrew--;else{if(1>c||c!==a.lastIndexOf(rewSep))return b.push("<strong>Error:</strong>"+escapeHTML(a)+"<br>Rewrite rules must be in the form x"+
rewSep+"y<br>That is, a rule (x), followed by "+("||"===rewSep?"two vertical bars":'the exact text "'+rewSep+'"')+", followed by a replacement expression (y, which may be blank)."),!1;var d=a.substring(c+2);a=handleCategoriesInRewriteRule(a.substring(0,c));a=new RegExp(a,"g");rew[p.toString()]=[a,d];p++}return!0}))&&(previousRew=f)}0>=categories.length&&b.push("<strong>Missing:</strong> You must have categories to generate text.");h&&0>=wordInitSyls.length?b.push("<strong>Missing:</strong> You must have syllable types to generate text."):
!h&&(0>=midWordSyls.length||0>=wordInitSyls.length||0>=wordFinalSyls.length||0>=singleWordSyls.length)&&b.push("<strong>Missing:</strong> You must have <em>all</em> syllable types to generate text.");if(0<b.length)var m=b.join("<br><br>");else switch(c){case "text":m=createText(g,h,d,k,e);break;case "dict":m=createLex(!1,g,h,d,k,e);break;case "dictC":m=createLex(!0,g,h,d,k,e);break;case "longdict":m=createLongLex(g,h,d,k,e);break;case "genall":m=getEverySyllable()}document.getElementById("outputText").innerHTML=
m}function calcDropoff(a,b){if(1===a)return 101;if(b)switch(a){case 2:return 50;case 3:return 40;case 4:case 5:case 6:case 7:case 8:case 9:return 46-4*a;default:return 9}return 9>a?60-5*a:12}function erase(){document.getElementById("outputText").innerHTML=null}
function clearBoxes(){document.getElementById("categories").value="";document.getElementById("wordInitial").value="";document.getElementById("midWord").value="";document.getElementById("singleWord").value="";document.getElementById("wordFinal").value="";document.getElementById("rewrite").value="";document.getElementById("monoLessFrequent").checked=!0;document.getElementById("dropoffMedium").checked=!0;document.getElementById("textOutput").checked=!0;document.getElementById("showSyls").checked=!1;
document.getElementById("slowSylDrop").checked=!1;document.getElementById("defaultName").textContent=""}function prepImport(a){"string"!==typeof a?document.querySelectorAll("#importBoxArea .msg").forEach(function(a){return a.classList.add("hidden")}):document.querySelectorAll("#importBoxArea .msg").forEach(function(b){b.classList.remove("hidden");b.innerHTML=a});document.getElementById("importBoxArea").classList.remove("closed");document.body.classList.add("noOverflow")}
function removeImportBox(){document.getElementById("importTextBox").value="";document.getElementById("importBoxArea").classList.add("closed");document.body.classList.remove("noOverflow")}
function doImport(a,b,c){a=void 0===a?document.getElementById("importTextBox").value.trim():a;b=void 0===b?!1:b;c=void 0===c?!0:c;a=/--CATEGORIES--\n([\s\S]*)\n--REWRITE--\n([\s\S]*)\n--MONO--\n([\s\S]*)\n--MID--\n([\s\S]*)\n--INIT--\n([\s\S]*)\n--FINAL--\n([\s\S]*)\n--FLAGS--\n([01]) ([01]) ([^ ]+) ([^ \n]+)(\n--ADVANCED--\n([0-9]+)\n([0-9]+)\n([0-9]+)\n([0-9]+)\n([^\n]+))?/.exec(a);if(b)return null===a?(console.log("Incorrect format."),!1):!0;if(null===a)return c?doAlert("Incorrect format.","",
"error"):!1;document.getElementById("categories").value=a[1];document.getElementById("rewrite").value=a[2];document.getElementById("singleWord").value=a[3];document.getElementById("midWord").value=a[4];document.getElementById("wordInitial").value=a[5];document.getElementById("wordFinal").value=a[6];document.getElementById("oneType").checked="0"!==a[7];document.getElementById("slowSylDrop").checked="0"!==a[8];document.getElementById(a[9]).checked=!0;document.getElementById(a[10]).checked=!0;if(12<
a.length&&void 0!==a[11]){for(b=12;16>b;){var d=Number(a[b]);if(!Number.isInteger(d)||1>d)a[b]="1";b++}document.getElementById("wordLengthInEms").value=a[12];document.getElementById("lexiconLength").value=a[13];document.getElementById("largeLexiconLength").value=a[14];document.getElementById("sentences").value=a[15];document.getElementById("rewSep").value=a[16]}syllablicChangeDetection();if(!c)return!0;doAlert("Import Successful!","","success");removeImportBox()}
function doExport(a){a=void 0===a?!0:a;if(null===a){var b=!0;var c="--CATEGORIES--\n"+document.getElementById("categories").defaultValue+"\n--REWRITE--\n"+document.getElementById("rewrite").defaultValue+"\n--MONO--\n"+document.getElementById("singleWord").defaultValue+"\n--MID--\n"+document.getElementById("midWord").defaultValue+"\n--INIT--\n"+document.getElementById("wordInitial").defaultValue+"\n--FINAL--\n"+document.getElementById("wordFinal").defaultValue+"\n--FLAGS--\n"+(document.getElementById("oneType").defaultChecked?
"1":"0")+" "+(document.getElementById("slowSylDrop").defaultChecked?"1":"0")+" ";document.querySelectorAll("input[name=monoRate]").forEach(function(a){b&&a.defaultChecked&&(c+=a.getAttribute("id")+" ",b=!1)});b=!0;document.querySelectorAll("input[name=dropoff]").forEach(function(a){b&&a.defaultChecked&&(c+=a.getAttribute("id"),b=!1)});return c}c="--CATEGORIES--\n"+document.getElementById("categories").value+"\n--REWRITE--\n"+document.getElementById("rewrite").value+"\n--MONO--\n"+document.getElementById("singleWord").value+
"\n--MID--\n"+document.getElementById("midWord").value+"\n--INIT--\n"+document.getElementById("wordInitial").value+"\n--FINAL--\n"+document.getElementById("wordFinal").value+"\n--FLAGS--\n"+(document.getElementById("oneType").checked?"1":"0")+" "+(document.getElementById("slowSylDrop").checked?"1":"0")+" "+document.querySelector("input[name=monoRate]:checked").getAttribute("id")+" "+document.querySelector("input[name=dropoff]:checked").getAttribute("id");if(!a)return c;c+="\n--ADVANCED--\n"+document.getElementById("wordLengthInEms").value+
"\n"+document.getElementById("lexiconLength").value+"\n"+document.getElementById("largeLexiconLength").value+"\n"+document.getElementById("sentences").value+"\n"+document.getElementById("rewSep").value;document.getElementById("importTextBox").value=c;prepImport("Copy this for your own records.<br><br>Hit 'Cancel' when you're done.")}
function saveCustom(a){var b=document.getElementById("predef");if(Customizable){if(CustomInfo&&!0!==a)return doConfirm("Warning!","You already have information saved. Do you want to overwrite it?",function(){saveCustom(!0)},function(){doAlert("Previous information saved.","Nothing overwritten.","success")},"warning","Yes","No");localStorage.setItem("CustomCategories",document.getElementById("categories").value);localStorage.setItem("CustomRewrite",document.getElementById("rewrite").value);localStorage.setItem("CustomSingleWord",
document.getElementById("singleWord").value);localStorage.setItem("CustomMidWord",document.getElementById("midWord").value);localStorage.setItem("CustomInitial",document.getElementById("wordInitial").value);localStorage.setItem("CustomFinal",document.getElementById("wordFinal").value);localStorage.setItem("CustomOneType",document.getElementById("oneType").checked);localStorage.setItem("CustomSlowSylDrop",document.getElementById("slowSylDrop").checked);localStorage.setItem("CustomMono",document.querySelector("input[name=monoRate]:checked").getAttribute("id"));
localStorage.setItem("CustomDropoff",document.querySelector("input[name=dropoff]:checked").getAttribute("id"));localStorage.setItem("CustomWordLengthInEms",document.getElementById("wordLengthInEms").value);localStorage.setItem("CustomLexiconLength",document.getElementById("lexiconLength").value);localStorage.setItem("CustomLargeLexiconLength",document.getElementById("largeLexiconLength").value);localStorage.setItem("CustomSentences",document.getElementById("sentences").value);localStorage.setItem("CustomRewSep",
document.getElementById("rewSep").value);CustomInfo=!0;null==b.querySelector('option[value="pd-1"]')&&(a=document.createElement("option"),a.value="pd-1",a.textContent="Custom",b.prepend(a));b.value="pd-1";predefs["pd-1"]=doExport(!1);doAlert("Saved to browser.","","success")}else doAlert("","Your browser does not support Local Storage and cannot save your information.","error")}
function clearCustom(a){if(Customizable)if(CustomInfo){if(CustomInfo&&!0!==a)return doConfirm("Warning!","Are you sure you want to delete your saved settings?",function(){clearCustom(!0)},function(){doAlert("Settings kept.","","success")},"warning","Yes","No");"CustomCategories CustomRewrite CustomSingleWord CustomMidWord CustomInitial CustomFinal CustomOneType CustomSlowSylDrop CustomMono CustomDropoff CustomWordLengthInEms CustomLexiconLength CustomLargeLexiconLength CustomSentences CustomRewSep".split(" ").forEach(function(a){window.localStorage.removeItem(a)});
CustomInfo=!1;document.querySelector('#predef option[value="pd-1"]').remove();delete predefs["pd-1"];doAlert("Cleared from browser.","","success")}else doAlert("","You don't have anything saved.","error");else doAlert("Sorry!","Your browser does not support Local Storage and cannot save your information.","error")}function showIPA(){document.getElementById("outputText").innerHTML=returnIPAPlus('<span class="desc">','</span>\n<div class="extraGroup">',"</div>\n","<br><br>")}
function advancedOptions(){document.getElementById("advancedOpen").classList.toggle("closed")}function loadThisPredef(a){console.log("DEPRECATED FUNCTION CALL")}function loadPredef(){var a=document.getElementById("predef").value;console.log(a);doImport(predefs[a],!1,!1);syllablicChangeDetection()}getter.addEventListener("load",parseResult);getter.open("GET",predefFilename);getter.send();document.getElementById("loadPredefButton").disabled=!0;document.getElementById("predef").disabled=!0;
predefs.pd1=doExport(null);predefs.counter=1;
function parseResult(){getter.responseText.trim().split(/\n--END--/).forEach(function(a){var b=a.trim().match(/^([^\r\n]+)\r?\n/);if(null===b)console.log("Unable to parse predef name: "+a);else{var c=b[0].trim();a=a.slice(b[0].length).replace(/\r/g,"").trim();console.log("Testing predef: "+c);if(doImport(a,!0)){b=document.getElementById("predef");var d=document.createElement("option"),e="pd";console.log("Saving predef: "+c);predefs.counter++;e+=predefs.counter.toString();predefs[e]=a;d.textContent=
c;d.value=e;b.appendChild(d)}else console.log(a.replace(/\n/g,"\\n"))}});document.getElementById("loadPredefButton").disabled=!1;document.getElementById("predef").disabled=!1}
function syllablicChangeDetection(){document.getElementById("oneType").checked?(document.querySelectorAll("#p_multi,.multiswap").forEach(function(a){return a.classList.add("hidden")}),document.querySelectorAll(".singleswap").forEach(function(a){return a.classList.remove("hidden")})):(document.querySelectorAll("#p_multi,.multiswap").forEach(function(a){return a.classList.remove("hidden")}),document.querySelectorAll(".singleswap").forEach(function(a){return a.classList.add("hidden")}))}
if("undefined"!==typeof Storage){Customizable=!0;if(null!==localStorage.getItem("CustomCategories")){CustomInfo=!0;var option=document.createElement("option"),propTrue=[localStorage.getItem("CustomMono"),localStorage.getItem("CustomDropoff")],propFalse=[];document.getElementById("categories").value=localStorage.getItem("CustomCategories");document.getElementById("rewrite").value=localStorage.getItem("CustomRewrite");document.getElementById("singleWord").value=localStorage.getItem("CustomSingleWord");
document.getElementById("midWord").value=localStorage.getItem("CustomMidWord");document.getElementById("wordInitial").value=localStorage.getItem("CustomInitial");document.getElementById("wordFinal").value=localStorage.getItem("CustomFinal");"true"===localStorage.getItem("CustomOneType")?propTrue.push("oneType"):propFalse.push("oneType");"true"===localStorage.getItem("CustomSlowSylDrop")?propTrue.push("slowSylDrop"):propFalse.push("slowSylDrop");propTrue.forEach(function(a){return document.getElementById(a).checked=
!0});propFalse.forEach(function(a){return document.getElementById(a).checked=!1});predefs["pd-1"]=doExport(!1);option.value="pd-1";option.textContent="Custom";document.getElementById("predef").prepend(option);document.getElementById("predef").value="pd-1"}syllablicChangeDetection()}document.getElementById("oneType").addEventListener("change",function(a){syllablicChangeDetection()});syllablicChangeDetection();document.getElementById("advancedOpenButton").addEventListener("click",advancedOptions);
document.getElementById("saveCustomButton").addEventListener("click",saveCustom);document.getElementById("clearCustomButton").addEventListener("click",clearCustom);document.getElementById("prepImportButton").addEventListener("click",prepImport);document.getElementById("generateButton").addEventListener("click",generate);document.getElementById("eraseButton").addEventListener("click",erase);document.getElementById("clearBoxesButton").addEventListener("click",clearBoxes);
document.getElementById("showIPAButton").addEventListener("click",showIPA);document.getElementById("loadPredefButton").addEventListener("click",loadPredef);document.getElementById("doImportButton").addEventListener("click",doImport);document.getElementById("removeImportBoxButton").addEventListener("click",removeImportBox);document.getElementById("doExportButton").addEventListener("click",doExport);
function doAlert(a,b,c){"undefined"!==typeof Swal?Swal.fire({type:c,title:a,html:b,customClass:"doAlertBox",buttonsStyling:!1}):alert((a+" "+b.replace(/<br>/g,"\n").replace(/<[^>]*>/g,"")).trim())}
function doConfirm(a,b,c,d,e,h,g){"undefined"!==typeof Swal?Swal.fire({title:a,html:b,type:void 0===e?"question":e,showCancelButton:!0,confirmButtonText:void 0===h?"Ok":h,cancelButtonText:void 0===g?"Cancel":g,customClass:"doAlertBox",buttonsStyling:!1}).then(function(a){return a.value?c():d()}):confirm((a+" "+b.replace(/<br>/g,"\n").replace(/<[^>]*>/g,"")).trim())?c():d()};
