// Script (C) 2012 by Mark Rosenfelder.
// You can modify the code for non-commercial use; 
// attribution would be nice.
// If you want to make money off it, please contact me.

// Modified by Jason Tamez 2017-2019.
// Code available here: https://github.com/jasontamez/wordgen


// ==ClosureCompiler==
// @compilation_level SIMPLE_OPTIMIZATIONS
// ==/ClosureCompiler==

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};var cat,ncat,previousCat=!1,syl,nsyl,wisyl,nwisyl,wfsyl,nwfsyl,snsyl,nsnsyl,previousSyl=!1,previousWisyl=!1,previousWfsyl=!1,previousSnsyl=!1,rew,nrew,previousRew=!1,rewSep=!1,CustomInfo=!1,Customizable=!1,zCounter;function parseSyllables(a){var b=[];a.split(/\r?\n/).forEach(function(a){a=a.trim();""!==a&&b.push(a)});return b}
function handleCategoriesInRewriteRule(a){a=a.split("%%");for(var b=[],c,d,f,h;a.length;){c=a.shift().split("!%");for(f=c.shift();c.length;)h=c.shift(),d=h.charAt(0),-1!==cat.index.indexOf(d)&&(f+="[^"+cat[d]+"]"),f+=h.substring(1);c=f.split("%");for(f=c.shift();c.length;)h=c.shift(),d=h.charAt(0),-1!==cat.index.indexOf(d)&&(f+="["+cat[d]+"]"),f+=h.substring(1);b.push(f)}return b.join("%")}
function applyRewriteRules(a){var b;for(b=0;b<nrew;b++){var c=rew[b.toString()];a=a.replace(c[0],c[1])}return a}function getRandomPercentage(){return Math.floor(101*Math.random())}function powerLaw(a,b){var c;for(c=0;;c=(c+1)%a)if(getRandomPercentage()<b)return c}function peakedPowerLaw(a,b,c){return.5<Math.random()?b+powerLaw(a-b,c):b-powerLaw(b+1,c)}
function oneSyllable(a,b,c,d){b=syllPatternPick(b,d);for(d=0;d<b.length;d++){var f=b.charAt(d);if(-1===cat.index.indexOf(f))a+=f;else{f=cat[f];var h=0===c?Math.random()*f.length:powerLaw(f.length,c);f=f.charAt(h);a+=f}}return a}function syllPatternPick(a,b){switch(a){case -1:var c=nwisyl;var d=wisyl;break;case 0:c=nsyl;d=syl;break;case 1:c=nwfsyl;d=wfsyl;break;case 2:c=nsnsyl,d=snsyl}return d[powerLaw(c,calcDropoff(c,b))]}
function getOneWord(a,b,c,d,f,h){var g=1,k,e="";Math.random()>b&&(g+=1+powerLaw(4,50));if(1===g)e=oneSyllable("",c?-1:2,f,h);else for(b=1;b<=g;b++)c||1===b?k=-1:1<b&&(k=b<g?0:1),e=oneSyllable(e,k,f,h),d&&b<g&&(e+="\u00b7");e=applyRewriteRules(e);a&&(e=e.charAt(0).toUpperCase()+e.substring(1));return e}
function createText(a,b,c,d,f){var h,g,k="",e=getAdvancedNumber("#sentences",30,500);for(h=0;h<e;h++){var l=1+peakedPowerLaw(15,5,50);for(g=0;g<l;g++)k+=getOneWord(0===g,a,b,c,d,f),g===l-1&&(k+=".....?!".charAt(Math.floor(7*Math.random()))),k+=" "}return k}
function createLex(a,b,c,d,f,h){var g,k='<div class="lexicon" style="grid-template-columns: repeat(auto-fit, minmax('+getAdvancedNumber("#wordLengthInEms",10,1E3)+'em, 1fr) )">\n',e=getAdvancedNumber("#lexiconLength",150,1E3);for(g=0;g<e;g++)k+="<div>"+getOneWord(a,b,c,d,f,h)+"</div>";return k+"</table></div>\n"}function createLongLex(a,b,c,d,f){var h,g="",k=getAdvancedNumber("largeLexiconLength",750,5E3);for(h=0;h<5*k;h++)g+=getOneWord(!1,a,b,c,d,f)+"<br>\n";return g}
function getAdvancedNumber(a,b,c){a=parseInt($(a).val());return isNaN(a)||1>a?b:a>c?c:a}function getEverySyllable(){var a=new Set;(new Set(syl.concat(wisyl,wfsyl,snsyl))).forEach(function(b){recurseCategories(a,"",b.split(""))});var b=[].concat($jscomp.arrayFromIterable(a));b.sort();return b.join("<br>")}
function recurseCategories(a,b,c){var d=[];d.push.apply(d,$jscomp.arrayFromIterable(c));c=d.shift();-1===cat.index.indexOf(c)?(b+=c,d.length?recurseCategories(a,b,d):a.add(applyRewriteRules(b))):0<d.length?cat[c].split("").forEach(function(c){recurseCategories(a,b+c,d)}):cat[c].split("").forEach(function(c){a.add(applyRewriteRules(b+c))})}function escapeHTML(a){a=document.createTextNode(a);var b=document.createElement("p");b.appendChild(a);return b.innerHTML}
function process(){var a,b=[];var c=$("input[type=radio][name=outtype]:checked").val();var d=$("#showsyl").prop("checked");var f=$("#slowsyl").prop("checked");var h=$("#onetype").prop("checked");var g=Number($("input[type=radio][name=monosyl]:checked").val());var k=Number($("input[type=radio][name=dropoff]:checked").val());g!==g||1<g?g=1:0>g&&(g=0);k!==k||45<k?k=45:0>k&&(k=0);var e=$("#cats").val();if(e!==previousCat){var l=e.split(/\r?\n/);ncat=l.length;cat={index:""};(l=l.every(function(c){c=c.trim();
var d=c.length;if(0===d)ncat--;else{if(3>d||1!==c.indexOf("=")||-1!==c.indexOf("=",2))return b.push("<strong>Error:</strong>"+escapeHTML(c)+"<br>Categories must be of the form V=aeiou<br>That is, a single letter, an equal sign, then a list of possible expansions."),!1;a=c.charAt(0);if(cat.hasOwnProperty(a))return b.push("<strong>Error:</strong> You have defined category "+escapeHTML(a)+" more than once."),!1;cat.index+=c.charAt(0);cat[a]=c.substring(2)}return!0}))&&0<ncat&&(previousCat=e)}e=$("#syls").val();
e!==previousSyl&&(syl=parseSyllables(e),nsyl=syl.length,previousSyl=e);e=$("#wrdi").val();e!==previousWisyl&&(wisyl=parseSyllables(e),nwisyl=wisyl.length,previousWisyl=e);e=$("#wrdf").val();e!==previousWfsyl&&(wfsyl=parseSyllables(e),nwfsyl=wfsyl.length,previousWfsyl=e);e=$("#sing").val();e!==previousSnsyl&&(snsyl=parseSyllables(e),nsnsyl=snsyl.length,previousSnsyl=e);e=$("#rewrite").val();l=$("#rewSep").val();if(previousRew!==e||l!==rewSep){rewSep=l;l=e.split(/\r?\n/);nrew=l.length;rew={};var n=
0;(l=l.every(function(a){var c=a.indexOf(rewSep);if(""===a.trim())nrew--;else{if(1>c||c!==a.lastIndexOf(rewSep))return b.push("<strong>Error:</strong>"+escapeHTML(a)+"<br>Rewrite rules must be in the form x"+rewSep+"y<br>That is, a rule (x), followed by "+("||"===rewSep?"two vertical bars":'the exact text "'+rewSep+'"')+", followed by a replacement expression (y, which may be blank)."),!1;var d=a.substring(c+2);a=handleCategoriesInRewriteRule(a.substring(0,c));a=new RegExp(a,"g");rew[n.toString()]=
[a,d];n++}return!0}))&&(previousRew=e)}0>=ncat&&b.push("<strong>Missing:</strong> You must have categories to generate text.");h&&0>=nwisyl?b.push("<strong>Missing:</strong> You must have syllable types to generate text."):!h&&(0>=nsyl||0>=nwisyl||0>=nwfsyl||0>=nsnsyl)&&b.push("<strong>Missing:</strong> You must have <em>all</em> syllable types to generate text.");if(0<b.length)var m=b.join("<br><br>");else switch(c){case "text":m=createText(g,h,d,k,f);break;case "dict":m=createLex(!1,g,h,d,k,f);
break;case "dictC":m=createLex(!0,g,h,d,k,f);break;case "longdict":m=createLongLex(g,h,d,k,f);break;case "genall":m=getEverySyllable()}$("#outputText").html(m)}function calcDropoff(a,b){if(1===a)return 101;if(b)switch(a){case 2:return 50;case 3:return 40;case 4:case 5:case 6:case 7:case 8:case 9:return 46-4*a;default:return 9}return 9>a?60-5*a:12}function erase(){$("#outputText").html("")}
"0"===a[7]?!1:!0);$("#slowsyl").prop("checked","0"===a[8]?!1:!0);$("#"+a[9]).prop("checked",!0);$("#"+a[10]).prop("checked",!0);if(12<a.length){for(b=12;16>b;){var c=Number(a[b]);if(!Number.isInteger(c)||1>c)a[b]="1";b++}$("#wordLengthInEms").val(a[12]);$("#lexiconLength").val(a[13]);$("#largeLexiconLength").val(a[14]);$("#sentences").val(a[15]);$("#rewSep").val(a[16])}syllablicChangeDetection($("#onetype")[0]);alert("Import Successful!");removeImportBox()}
function clearBoxes(){$("#cats,#wrdi,#syls,#sing,#wrdf,#rewrite").val("");$("#monoLessFrequent,#dropoffMedium,#textOutput").prop("checked",!0);$("#showsyl,#slowsyl").prop("checked",!1);$("#defaultName").text("")}function prepImport(){$("#importBoxArea").removeClass("closed");$("body").css("overflow","hidden")}function removeImportBox(){$("#importTextBox").val("");$("#importBoxArea").addClass("closed");$("body").css("overflow","auto")}
function doImport(){var a=$("#importTextBox").val();a=/--CATS--\n([\s\S]*)\n--REWRITE--\n([\s\S]*)\n--MONO--\n([\s\S]*)\n--MID--\n([\s\S]*)\n--INIT--\n([\s\S]*)\n--FINAL--\n([\s\S]*)\n--FLAGS--\n([01]) ([01]) ([^ ]+) ([^ \n]+)(\n--ADVANCED--\n([0-9]+)\n([0-9]+)\n([0-9]+)\n([0-9]+)\n([^\n]+))?/.exec(a);var b;if(null===a)return doAlert("Incorrect format.","","error");$("#cats").val(a[1]);$("#rewrite").val(a[2]);$("#sing").val(a[3]);$("#syls").val(a[4]);$("#wrdi").val(a[5]);$("#wrdf").val(a[6]);$("#onetype").prop("checked",
function doExport(){var a="--CATS--\n"+$("#cats").val()+"\n--REWRITE--\n"+$("#rewrite").val()+"\n--MONO--\n"+$("#sing").val()+"\n--MID--\n"+$("#syls").val()+"\n--INIT--\n"+$("#wrdi").val()+"\n--FINAL--\n"+$("#wrdf").val()+"\n--FLAGS--\n"+($("#onetype").prop("checked")?"1":"0")+" "+($("#slowsyl").prop("checked")?"1":"0")+" "+$("input[name=monosyl]:checked").attr("id")+" "+$("input[name=dropoff]:checked").attr("id")+"\n--ADVANCED--\n"+$("#wordLengthInEms").val()+"\n"+$("#lexiconLength").val()+"\n"+
$("#largeLexiconLength").val()+"\n"+$("#sentences").val()+"\n"+$("#rewSep").val();$("#importTextBox").val(a);prepImport();alert("Export Successful. Copy this for your own records.\n\nHit 'Cancel' when you're done.")}
function saveCustom(){Customizable?CustomInfo&&!confirm("You already have information saved. Do you want to overwrite it?")?alert("Previous information saved."):(localStorage.setItem("CustomCats",$("#cats").val()),localStorage.setItem("CustomRewrite",$("#rewrite").val()),localStorage.setItem("CustomSing",$("#sing").val()),localStorage.setItem("CustomSyls",$("#syls").val()),localStorage.setItem("CustomWrdi",$("#wrdi").val()),localStorage.setItem("CustomWrdf",$("#wrdf").val()),localStorage.setItem("CustomOneType",
$("#onetype").prop("checked")),localStorage.setItem("CustomSlowsyl",$("#slowsyl").prop("checked")),localStorage.setItem("CustomMono",$("input[name=monosyl]:checked").attr("id")),localStorage.setItem("CustomDropoff",$("input[name=dropoff]:checked").attr("id")),localStorage.setItem("CustomWordLengthInEms",$("#wordLengthInEms").val()),localStorage.setItem("CustomLexiconLength",$("#lexiconLength").val()),localStorage.setItem("CustomLargeLexiconLength",$("#largeLexiconLength").val()),localStorage.setItem("CustomSentences",
$("#sentences").val()),localStorage.setItem("CustomRewSep",$("#rewSep").val()),CustomInfo=!0,1>$("#predef option[value=-1]").length&&$("#predef").prepend('<option value="-1">Custom</option>'),$("#predef").val("-1"),alert("Saved to browser.")):alert("Your browser does not support Local Storage and cannot save your information.")}
function clearCustom(){Customizable?CustomInfo?confirm("Are you sure you want to delete your saved settings?")?("CustomCats CustomRewrite CustomSing CustomSyls CustomWrdi CustomWrdf CustomOneType CustomSlowsyl CustomMono CustomDropoff CustomWordLengthInEms CustomLexiconLength CustomLargeLexiconLength CustomSentences CustomRewSep".split(" ").forEach(function(a){window.localStorage.removeItem(a)}),CustomInfo=!1,$("#predef option[value=-1]").remove(),alert("Cleared from browser.")):alert("Settings kept."):
alert("You don't have anything saved."):alert("Your browser does not support Local Storage and cannot save your information.")}function showipa(){$("#outputText").html(returnIPAPlus('<span class="desc">','</span>\n<div class="extraGroup">',"</div>\n","<br><br>"))}function advancedOptions(){$("#advancedOpen").toggleClass("closed")}
function loadThisPredef(a){switch(a){case -1:CustomInfo?($("#cats").val(localStorage.getItem("CustomCats")),$("#rewrite").val(localStorage.getItem("CustomRewrite")),$("#sing").val(localStorage.getItem("CustomSing")),$("#syls").val(localStorage.getItem("CustomSyls")),$("#wrdi").val(localStorage.getItem("CustomWrdi")),$("#wrdf").val(localStorage.getItem("CustomWrdf")),$("#onetype").prop("checked","true"===localStorage.getItem("CustomOneType")),$("#slowsyl").prop("checked","true"===localStorage.getItem("CustomSlowsyl")),
$("#"+localStorage.getItem("CustomMono")).prop("checked",!0),$("#"+localStorage.getItem("CustomDropoff")).prop("checked",!0),null!==localStorage.getItem("CustomRewSep")&&($("#wordLengthInEms").val(localStorage.getItem("CustomWordLengthInEms")),$("#lexiconLength").val(localStorage.getItem("CustomLexiconLength")),$("#largeLexiconLength").val(localStorage.getItem("CustomLargeLexiconLength")),$("#sentences").val(localStorage.getItem("CustomSentences")),$("#rewSep").val(localStorage.getItem("CustomRewSep")))):
loadThisPredef(0);break;case 1:$("#cats").val("C=ptkbdg\nR=rl\nV=ieaou");$("#wrdi").val("CV\nV\nCRV");$("#syls,#sing,#wrdf").val("");$("#onetype").prop("checked",!0);$("#slowsyl").prop("checked",!1);$("#rewrite").val("ki||"+String.fromCharCode(269)+"i");$("#monoLessFrequent,#dropoffMedium").prop("checked",!0);break;case 2:$("#cats").val("C=ptknslrmbdgfvwyh"+String.fromCharCode(353)+"z"+String.fromCharCode(241)+"x"+String.fromCharCode(269,382,330)+"\nV=aiuoe"+String.fromCharCode(603,596,226,244,252,
246)+"\nR=rly");$("#wrdi").val("CV\nV\nCVC\nCRV");$("#syls,#sing,#wrdf").val("");$("#rewrite").val(String.fromCharCode(226)+"||ai\n"+String.fromCharCode(244)+"||au");$("#onetype").prop("checked",!0);$("#slowsyl").prop("checked",!1);$("#monoLessFrequent,#dropoffMedium").prop("checked",!0);break;case 3:$("#cats").val("C=tkpnslrmfbdghvyh\nV=aiueo\nU=aiu"+String.fromCharCode(224,234)+"\nR=rl\nM=nsrmltc\nK=ptkbdg");$("#wrdi").val("CV\nCUM\nV\nUM\nKRV\nKRUM");$("#syls,#sing,#wrdf").val("");$("#rewrite").val("ka||ca\nko||co\nku||cu\nkr||cr");
$("#onetype").prop("checked",!0);$("#slowsyl").prop("checked",!1);$("#monoLessFrequent,#dropoffMedium").prop("checked",!0);break;case 4:$("#cats").val("C=tpknlrsm"+String.fromCharCode(654)+"bdg"+String.fromCharCode(241)+"fh\nV=aieuo"+String.fromCharCode(257,299,363,275,333)+"\nN=n"+String.fromCharCode(331));$("#wrdi").val("CV\nV\nCVN");$("#syls,#sing,#wrdf").val("");$("#rewrite").val("aa||"+String.fromCharCode(257)+"\nii||"+String.fromCharCode(299)+"\nuu||"+String.fromCharCode(363)+"\nee||"+String.fromCharCode(275)+
"\noo||"+String.fromCharCode(333)+"\nnb||mb\nnp||mp");$("#onetype").prop("checked",!0);$("#slowsyl").prop("checked",!1);$("#monoLessFrequent,#dropoffMedium").prop("checked",!0);break;case 5:$("#cats").val("C=ptknlsm"+String.fromCharCode(353)+"yw"+String.fromCharCode(269)+"hf"+String.fromCharCode(331)+"\nV=auieo\nR=rly\nN=nn"+String.fromCharCode(331)+"mktp\nW=io\nQ=ptk"+String.fromCharCode(269));$("#wrdi").val("CV\nQ"+String.fromCharCode(688)+"V\nCVW\nCVN\nVN\nV\nQ"+String.fromCharCode(688)+"VN");
$("#syls,#sing,#wrdf").val("");$("#rewrite").val("uu||wo\noo||ou\nii||iu\naa||ia\nee||ie");$("#slowsyl").prop("checked",!1);$("#onetype").prop("checked",!0);$("#monoLessFrequent,#dropoffMedium").prop("checked",!0);break;case 6:$("#cats").val("S=tspkThfS\nC=kstSplrLnstmTNfh\nI=aoueAOUE\nV=aoiueAOUE\nE=sfSnmNktpTh");$("#rewrite").val("([aeiou])\\1{2,}||$1$1\n([AEOU])\\1+||$1\n(%V{2})%V+||$1\nh+||h\nh(%V%E)\\b||H$1\nh(%V%C{0,2}%V)\\b||H$1\n(%V)h(%V)\\b||$1H$2\n\\bh||H\nh\\b||H\nh||\nH||h\nA||a"+String.fromCharCode(301)+
"\nO||o"+String.fromCharCode(301)+"\nU||u"+String.fromCharCode(301)+"\nE||e"+String.fromCharCode(301)+"\n"+String.fromCharCode(301)+"i||i\n"+String.fromCharCode(301)+"T||"+String.fromCharCode(301)+"t\n"+String.fromCharCode(301)+"S||"+String.fromCharCode(301)+"s\n"+String.fromCharCode(301)+"L||"+String.fromCharCode(301)+"l\n"+String.fromCharCode(301)+"N||"+String.fromCharCode(301)+"n\n(\\B.\\B[aeou])i||$1"+String.fromCharCode(301)+"\n(%C)\\1||$1\n[tkpT]r||r\nn[pTk]||nt\nm[tTk]||mp\nN[ptk]||NT\nk[nmN]||k\np[nN]||pm\nt[mN]||tn\nT[nm]||TN\np[sSh]||pf\nt[fSh]||ts\nT[fsh]||TS\nk[fsS]||kh\nf[sSh]||fp\ns[fSh]||st\nS[fsh]||ST\nh[fsS]||hk\nft||fp\nsT||st\nSt||ST\n([TSLN])[tsln]||$1\n([tsln])[TSLN]||$1\nNT||nT\nTN||tN\nST||sT\nTS||tS\nT||t"+
String.fromCharCode(769)+"\nL||"+String.fromCharCode(314)+"\nS||"+String.fromCharCode(347)+"\nN||"+String.fromCharCode(324));$("#sing").val("SV\nSVE\nSV\nSV");$("#syls").val("SV\nI\nCV\nSVC");$("#wrdi").val("SV\nV\nSVC");$("#wrdf").val("I\nVE\nV\nVE\nSVE\nV\nCV\nVE\nCVE");$("#onetype,#slowsyl").prop("checked",!1);$("#monoRare,#dropoffMedium").prop("checked",!0);break;case 7:$("#cats").val("I=rlmnpbBTRG\nC=pbtdkgnmGszSZwrlBTR\nE=pbtdkgnmGl\nM=pbtdkgnmGrlszSZw\nS=pbtdkg\nN=nmG\nX=szSZwrlnmG\nA=wrl\nV=aIuioe");
$("#rewrite").val("^(b|p)w||$1\n^G||w\n(%X)%X||$1\n(%N|%A)(%S)||$2\n%X(%S%A)||$1\n^g([ei])||gh$1\nG||ng\nS||sh\nZ||zh\ni||ee\nI||i\ni$||e\nB||"+String.fromCharCode(664)+"\nT||"+String.fromCharCode(451)+"\nR||"+String.fromCharCode(450));$("#sing").val("IVN\nVS\nCVE\nSAV\nSAVE\nCV\nCVN");$("#syls").val("SV\nNV\nMV\nSAV\nSV\nSV\nNV\nMV\nSAV\nSVX\nMVX\nSAVX");$("#wrdi").val("SV\nIV\nAV\nCV\nSAV\nVX\nSV\nIV\nAV\nCV\nSAV\nVX\nAVX\nCVX\nIVX\nVX\nSAVX");$("#wrdf").val("MV\nMVE\nMV\nMVE\nSAV\nSAVE");$("#onetype,#slowsyl").prop("checked",
!1);$("#monoFrequent,#dropoffSlow").prop("checked",!0);break;default:return alert("Choose something from the list, first.")}syllablicChangeDetection($("#onetype")[0])}function loadPredef(){var a=$("#predef").val();loadThisPredef(Number(a))}function syllablicChangeDetection(a){a.checked?($("#p_multi,.multiswap").hide(),$(".singleswap").show()):($("#p_multi,.multiswap").show(),$(".singleswap").hide())}
"undefined"!==typeof Storage&&(Customizable=!0,null!==localStorage.getItem("CustomCats")&&(CustomInfo=!0,$("#predef").prepend('<option value="-1">Custom</option>'),$("#predef").val("-1"),loadThisPredef(-1)));$("#onetype").change(function(){syllablicChangeDetection($("#onetype")[0])});syllablicChangeDetection($("#onetype")[0]);
